<div class="qr-code-container" [class.loading]="isLoading()">
  @if (isLoading()) {
    <!-- Loading skeleton -->
    <div
      class="qr-code-skeleton"
      role="status"
      [attr.aria-label]="'urlBuilder.qrCode.generating' | translate">
      <div class="spinner"></div>
      <p>{{ 'urlBuilder.qrCode.generating' | translate }}</p>
    </div>
  } @else {
    <!-- QR Code Display -->
    <div class="qr-code-display">
      <qrcode
        [qrdata]="qrData()"
        [width]="currentOptions().width"
        [errorCorrectionLevel]="currentOptions().errorCorrectionLevel"
        [margin]="currentOptions().margin"
        [colorDark]="currentOptions().colorDark"
        [colorLight]="currentOptions().colorLight"
        [elementType]="currentOptions().renderType"
        [cssClass]="currentOptions().cssClass || 'qr-code'"
        [alt]="
          currentOptions().alt || ('urlBuilder.qrCode.aria.alt' | translate)
        "
        [ariaLabel]="
          currentOptions().ariaLabel || ('urlBuilder.qrCode.aria.scannable' | translate)
        ">
      </qrcode>
    </div>

    @if (showControls()) {
      <!-- Customization Controls -->
      <div class="qr-code-controls">
        <div class="control-group">
          <label for="qr-size">{{ 'urlBuilder.qrCode.options.size' | translate }}</label>
          <select
            id="qr-size"
            [value]="selectedSize()"
            (change)="onSizeChange(+$any($event.target).value)"
            class="form-select">
            <option [value]="QrCodeSizePreset.SMALL">
              {{ 'urlBuilder.qrCode.options.small' | translate }}
            </option>
            <option [value]="QrCodeSizePreset.MEDIUM">
              {{ 'urlBuilder.qrCode.options.medium' | translate }}
            </option>
            <option [value]="QrCodeSizePreset.LARGE">
              {{ 'urlBuilder.qrCode.options.large' | translate }}
            </option>
            <option [value]="QrCodeSizePreset.XLARGE">
              {{ 'urlBuilder.qrCode.options.xlarge' | translate }}
            </option>
          </select>
        </div>

        <div class="control-group">
          <label for="qr-error-correction">
            {{ 'urlBuilder.qrCode.options.errorCorrection' | translate }}
          </label>
          <select
            id="qr-error-correction"
            [value]="selectedErrorCorrection()"
            (change)="onErrorCorrectionChange($any($event.target).value)"
            class="form-select">
            <option [value]="ErrorCorrectionLevel.L">
              {{ 'urlBuilder.qrCode.options.errorCorrectionLevels.low' | translate }}
            </option>
            <option [value]="ErrorCorrectionLevel.M">
              {{ 'urlBuilder.qrCode.options.errorCorrectionLevels.medium' | translate }}
            </option>
            <option [value]="ErrorCorrectionLevel.Q">
              {{ 'urlBuilder.qrCode.options.errorCorrectionLevels.quartile' | translate }}
            </option>
            <option [value]="ErrorCorrectionLevel.H">
              {{ 'urlBuilder.qrCode.options.errorCorrectionLevels.high' | translate }}
            </option>
          </select>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="qr-code-actions">
        <button
          type="button"
          (click)="onDownload(QrCodeExportFormat.PNG)"
          class="btn btn-secondary"
          [attr.aria-label]="'urlBuilder.qrCode.download.png' | translate">
          {{ 'urlBuilder.qrCode.download.png' | translate }}
        </button>
        <button
          type="button"
          (click)="onDownload(QrCodeExportFormat.SVG)"
          class="btn btn-secondary"
          [attr.aria-label]="'urlBuilder.qrCode.download.svg' | translate">
          {{ 'urlBuilder.qrCode.download.svg' | translate }}
        </button>
        <button
          type="button"
          (click)="onCopy()"
          class="btn btn-secondary"
          [attr.aria-label]="'urlBuilder.qrCode.copyToClipboard' | translate">
          {{ 'urlBuilder.qrCode.copyToClipboard' | translate }}
        </button>
      </div>
    }
  }
</div>
